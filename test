void init2(tcp_server* server)
{
	server->set_on_connect([&] (std::map<int, vm::tcp_client>& clients,
				vm::tcp_client& client)
			   {
			       std::string msg = "HTTP/1.1 200 OK\nContent-Type: text/plain; charset=utf-8\nContent-Length: 5\n\n12345";
			       client.send_data(msg);
			       server->disconnect_client(client);
			       std::cout << "disconnected" << std::endl;
			   });
}


int main(int argc, char *argv[]) {
    tcp_server* server;
    if (argc < 2) {
	fprintf(stderr, "Usage: %s [port]\n", argv[0]);
	return 0;
    } else if (argc == 2)
	server = new tcp_server("localhost", argv[1]);
    else
	server = new tcp_server(argv[1], argv[2]);

    //init1(server);
    init2(server);

    server->start();
}
